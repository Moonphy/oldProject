<!doctype html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="http://dev.css.com/css/default/base.css"/>
    <link rel="stylesheet" href="http://dev.css.com/css/default/data_v3.css"/>
    <script type="text/javascript" src="gaofen.js"></script>
	<style>
		#scrollArea {margin-left:400px}
		ul {
			padding : 0;
			margin : 0;
		}
	
		.scrollBar {
			width: 533px;
			height: 13px;
			margin: 14px 0 0 0;
			display: inline;
			float: left;
			background: url(img/scorll_border.gif) repeat-x 0 center;
			position: relative;
			overflow: hidden;
			background : yellow;
		}
		
		.drag_no {
			position: absolute;
			top: 1px;
			left: 0px;
			cursor: pointer;
			display: block;
			width: 300px;
			height: 13px;
			background : blue;
		}
		
		
		.listM {
			width: 534px;
			height: 82px;
			overflow: hidden;
			float: left;
			position: relative
		}
		
	    .listM ul {
			width: 10000px;
			float: left;
			left: 0px;
			margin-left: 0;
			list-style: none;
		}
		
		.listM li {
			width: 534px;
			padding: 0 5px 0 0;
			float: left;
			text-align: center;
			height: 78px;
		}
		
		.listM li img {
			width: 80px;
			height: 60px;
		}
		
		
		.scrollBar2 {
			width: 13px;
			height: 513px;
			margin: 14px 0 0 0;
			display: inline;
			float: left;
			background: url(img/scorll_border.gif) repeat-x 0 center;
			position: relative;
			overflow: hidden;
			background : yellow;
		}
		
		.drag_no2 {
			position: absolute;
			top: 1px;
			left: 0px;
			cursor: pointer;
			display: block;
			width: 13px;
			height: 33px;
			background : blue;
		}
		
		body{
			height : 1500px;
		
		}
		.current {
			broder : 1px solid;
			background : yellow;
		}
		
	</style>
</head>

<body>	
<br></br><br></br><br></br><br></br><br></br><br></br>
<!--
<div id="scrollArea">
	
	<div class="listM" >
		<ul id="thumb" >
			<li style="padding-left: 2px;"><a href="#p=1"><img src="http://file.gaofen.com/html/v5/img/shop/v2/gkkd/1.jpg"></a>
			<h2>1<span>/4</span></h2></li>			
			<li class=""><a href="#p=2"><img src="http://file.gaofen.com/html/v5/img/shop/v2/gkkd/2.jpg"></a><h2>2<span>/4</span></h2></li>
			<li class=""><a href="#p=3"><img src="http://file.gaofen.com/html/v5/img/shop/v2/gkkd/3.jpg"></a><h2>3<span>/4</span></h2></li>
			<li class=""><a href="#p=4"><img src="http://file.gaofen.com/html/v5/img/shop/v2/gkkd/2.jpg"></a><h2>2<span>/4</span></h2></li>
			<li class=""><a href="#p=5"><img src="http://file.gaofen.com/html/v5/img/shop/v2/gkkd/3.jpg"></a><h2>3<span>/4</span></h2></li>
			<li class=""><a href="#p=6"><img src="http://file.gaofen.com/html/v5/img/shop/v2/gkkd/2.jpg"></a><h2>2<span>/4</span></h2></li>
			<li class=""><a href="#p=7"><img src="http://file.gaofen.com/html/v5/img/shop/v2/gkkd/3.jpg"></a><h2>3<span>/4</span></h2></li>
			<li class=""><a href="#p=8"><img src="http://file.gaofen.com/html/v5/img/shop/v2/gkkd/2.jpg"></a><h2>2<span>/4</span></h2></li>
			<li class="current"  ><a href="#p=9"><img src="http://file.gaofen.com/html/v5/img/shop/v2/gkkd/3.jpg"></a><h2>3<span>/4</span></h2></li>
			<li   style="padding-right: 2px;"><a href="#p=4"><img src="http://file.gaofen.com/html/v5/img/shop/v2/gkkd/4.jpg"></a><h2>4<span>/4</span></h2></li>
		</ul>
	</div>
	<div style="clear:both;"></div>
	<div class="scrollBar" id="scrollBar">
		<a class="drag_no" id="bar" href="#" style="width: 313px;"><b class="l_arrow"></b><b class="c_arrow"></b><b class="r_arrow"></b></a>
	</div>
	<div id="ext">
		<a href="#" >上一张</a><input value="1"><a href="#" >下一张</a>
	</div>
</div>
-->
<div class="picture-previewer" id="scrollArea">
	<div class="picture-container" id="thumb">
		<div class="item">
			<img src="../../../assets/img/dummy_748x561.png" alt="">
			<span class="loading hidden"></span>
		</div>
		<div class="item hidden">
			<div class="pay-tips">
				<p>免费试读已结束，购买后可继续阅读或下载。</p>
				<div class="actions"><a href="#" class="btn btn-primary">立即购买</a><span class="hl">2元</span>
				</div>
			</div>
		</div>
	</div>
	<a href="#" class="prev" rel="e:left,na:1"></a>
	<a href="#" class="next" rel="e:right,na:1"></a>
	<div class="scrollbar"  id="scrollBar">
		<div class="track"  rel="e:toPage,na:1"></div>
		<div style="width:0%" class="progress"></div>
		<span class="drag" id="dragBar">
			<span class="tooltip hidden">第<span id="page">1</span>页<i class="arrow"><i class="arrow-border"></i><i class="arrow-body"></i></i></span>
		</span>
	</div>
	<!-- Start:资料预览工具条-->
	<div id="readControl" style="opacity: 1;" class="preview-toolbar">
		<div class="in">
			<div class="control"><a id="prev" rel="e:left,na:1" href="#" title="上一页" class="page-prev">上一页</a>
				<input type="text" value="1"  id="pageIpt"><span id="pageTotal">/41</span><a id="next" href="#" title="下一页" class="page-next" rel="e:right,na:1">下一页</a>
			</div>
			<div class="zoom"><a href="#" class="full-in"  rel="e:cmodel,f:1,na:1">全屏</a><a href="#" class="full-out"  rel="e:cmodel,f:0,na:1">退出全屏</a>
			</div>
			<div class="operation">
				<!-- 未付款--><a rel="e:ddoc,id:eXdrWUd4YUpsdW89,t:2" href="javascript:void(0)" title="立即下载" class="btn btn-primary btn-small">购买</a><span class="hl">3元</span>
			</div>
		</div>
	</div>
	<!-- End:资料预览工具条-->
	
</div>
<div id="readercontainerfull" class="full-wrap"></div>
<script>
	$(document).ready(function(){		
		var ps = Gaofen.use('pptScroll', {
			veiw : $('#scrollArea')[0],
			pages : [
			"SU8vU2twdC9xT2hOR0pSeUwwYlhZYkNlVzZzUzM2SXJQYTVtQ1ZxT1k3d2lMODBHb2N0Y0p2WVphWjNsdGpQaThJd2VmNXZLT0RCcGpKOTZDUTN4dlE9PQ==",
			'RjFkS1E1bVowdzFnWGZHblNBeDREUTJUWXVCTTlyVXdGZHJ3U3RSR1NRUEJPS2l1OFIyMk9iU3dnQzdwUm9lKzE0OVBOLys2UGRCNDFlY21TSWw3V2c9PQ',
			'ejhjK25CRWx0TlR0SW8wUSttT0RpMHpZUG5NMDNVSGp4RkdRODNPNGFHRkdpSlZBaGJqQ1lHVW44dVdBQWJMc0REMGtwcG9SdElQRkxKN0cyNWpJQVE9PQ',
			'eU9BS2dYT0NwZDNTaDdRdDBjVUYrZm9Eb2FRZSs1WTcrcjFiZGpBTlRIVXRIaWNNN3AvQ0gwVE40ZnBHQVJ1NGF5SG5ueWw5TFphRytncjkxejhMTGc9PQ'
			], 
			total:20,
			dragBar : $('#dragBar'),
			scrollBar: $('#scrollBar'),
			offMargin : 400
			});
		console.log(ps);
	/*
		var pptScroll = function(opt){
				
			var def = {
				view : $('#scrollArea'),
				childrens : null,
				current : 'current',
				model : 'comment',//一般模式\全屏模式
				modelSize : {'comment':{w:748,h:561}, 'full' : ''},//一般模式
				currentLen : 1,
				host : 'http://ziliao.gaofen.com/',
				total : 10,//总页数
				fid : 'NUdNcmg1dTczdUJ2OGJTdE9VK0FPNXNnemNHbXRLZndPc1Qya0lFNTY0eTU0VHpZb1FhbHoySG1VY2VHdjNrYWdGdS9LcEpOeG90emdiMXI2QUd2eUE9PQ==',
				pages : [],//图片地址列表
				maxPage : 0,//最大显示页数
				camera : '.listM',
				itemPix : null,//每个所占比例
				picList : $('#thumb')
			};
			
			
			$.extend(this, $.extend(def, opt));
			var readLen = this.maxPage = this.pages.length;
			if(readLen === this.total){
				this.picList.find('item:eq(1)').remove();
			}
			
			if(this.childrens === null)
				this.childrens = this.picList.children();
			this.setShow(0, this.pages[0]);
			
			this.itemPix = Number((100/this.total).toFixed(2));
			jqview.css('left', 0);
			var self = this;
			initTipDarg(function(pl){
				self.draging(pl);
				self.setTips(1,pl);
			}, function(pl){				
				self.setTips(0);
				if(pl){
					self.compute(self.getNextItem(pl));
					jqview.css('top', '-6px');
				}
			}, function(){
				self.setTips(1);
				console.log('beforeDarg');
			});
			container.click(function(e){
				var pl = (e.clientX- offMargin)/ (container.width());				
				self.compute(self.getNextItem(pl));
			});
			jqview.click(function(e){
				e.stopPropagation();
			});
			
			//this.prev = this.view.find('a.prev');
			//this.next = this.view.find('a.next');
			
			this.init();
		
		}
		
		pptScroll.prototype = {
		
			init : function(){
				var self = this;
				this.picList.delegate("li","click",function(){
					self.select($(this).index());
				});
				$('.page-prev,.prev', this.view).click(function(e){
					e.preventDefault();
					self.toLeft();
				});
				$('.page-next,.next', this.view).click(function(e){
					e.preventDefault();
					self.toRight();
				});
				$('#pageTotal', this.view).text('/'+this.total);
			},
			
			getUrl : function(src){
				var host = this.host, fid = this.fid;
				return host+'docs/docsImage?id='+fid+'&image='+src;
			},
			
			getImage : function(divItem, src){
				var img = divItem.find('img'), _src = this.getUrl(src), loading = divItem.find('.loading');
				loading.cssDisplay(1);
				img.cssDisplay(0);				
				Gaofen.util.getImageSizeByValue(_src, {w:748,h:561}, function(obj){
					img.attr('src',_src).css(obj);
					Gaofen.util.setImagePosition(img, obj.width, obj.height, 748, 561);
					loading.cssDisplay(0);
					img.cssDisplay(1);					
				});
				
			},
			
			setShow : function(item, src){
				item = this.childrens.eq(item);
				var index = item.index(), vdiv = this.picList.find('.item:visible');
				if(index === 0 && src){	
					this.getImage(item, src);
					//item.find('img').attr('src', this.getUrl(src));
				}
				
				if(vdiv.index() !== index){					
					vdiv.cssDisplay(0);
					item.cssDisplay(1);
				}				
			},
			
			setTips : function(dp, l){
				if(dp === 0){
					jqview.find('.tooltip').cssDisplay(0);
				}else{
					var page = l ? Math.ceil((Number(Number(l*100).toFixed(2)))/this.itemPix) : this.currentLen;
					jqview.find('#page').text(page);
					jqview.find('.tooltip').cssDisplay(1);
				}
			},
			
			setProgress : function(l){
				container.find('.progress').width(l+'%');
			},
			
			draging : function(l){
				l = Number(Number(l*100).toFixed(2));
				this.setProgress(l);
			},
			
			getNextItem : function(pl){
				var itemPix = this.itemPix;
				pl = Number(Number(pl*100).toFixed(2));
				var nextItem = Math.ceil(pl/itemPix);
				return nextItem;
			},
			
			compute : function(nextItem){
				if(nextItem === this.currentLen){//选中当前不变
					var dragPix = this.currentLen * this.itemPix;
				}else{
					if(this.maxPage >= nextItem ){
						this.setCurrent(nextItem);
						this.setShow(0, this.pages[this.currentLen-1]);
					}else{//超出可显示数提示付费
						this.setCurrent(this.maxPage+1);
						this.setShow(1);
					}
				}
				this.resetBar();
			},
			
			toRight : function(){
				this.compute(this.currentLen + 1);
			},
			
			toLeft : function(){
				if(this.currentLen - 1 === 0) return;
				this.compute(this.currentLen - 1);
			},
			
			resetBar : function(){
				var itemPix = this.itemPix, citem = this.currentLen, pbarLeft = container.offset().left;
				if(this.currentLen !== this.pages.length) citem -=1;
				var left = pbarLeft+itemPix*citem*container.width()/100;
				if(citem === this.pages.length) left -=36;
				jqview.offset({'left':left});
				this.setProgress(citem*itemPix);
			},
			
			getCurrent : function(){
				return this.picList.find('.'+this.current);
			},
			
			setCurrent : function(v){
				this.currentLen = v;
				this.setInput(v);
			},
			
			setInput : function(){
				this.view.find('#pageIpt').val(this.currentLen);
			},
			
			select : function(index){
				this.getCurrent().removeClass(this.current);
				
				if(this.childrens){
					this.childrens.eq(index).addClass(this.current);
				}
			}
		
		};
	

		var Drag  = function(opt){
			var defaultOpt = {
				view : '',	//拖动体			
				handle : '',//拖动位置
				outside : true, //要判断是否超出边界
				outsideToLimit : true,//超出边界后按极限处理(false:恢复原来位置，true:按最大极限处理)
				outsideStop : false,//超出边界后停止拖动
				beforeDarg : $.noop,//拖动前回调
				afterDarg : $.noop,//停止拖动回调
				moved : false,//拖动过
				movePart : $('body'),//
				onlyChange : false,
				container : '',
				dlagIngCls : 'dlaging'　　//拖动体样式
			};
			$.extend(this, defaultOpt, opt);
			
			this.init();
		}
		
		Drag.prototype = {
		
			init : function(){
				var that = this,
					view = this.view, 
					handle = this.handle;
					
				if(this.outside){//是否要判断超出边界
					if(this.container === '') this.container = this.movePart;
					var container = this.container,
						movePath = this.movePart,
						offset = container.offset(),
						cwidth = container.width(),
						cheight = container.height();
						width = view.width(),
						height = view.height();
					$.extend(this, {
						cwidth : cwidth,
						cheight : cheight,
						width : width,
						height : height,
						minLeft : offset.left,
						minTop : offset.top,
						maxLeft : offset.left + cwidth - width,
						maxTop  : offset.top + cheight - height		
					});			
				}
				if(view.length && handle.length){
					handle.bind({
						mousedown : $.proxy(this.bind, this),
						mouseup : $.proxy(this.unbind, this)
					});
					this.movePart.mouseleave($.proxy(this.unbind, this));
					$(window)					
					.mouseleave(function(e){
						if(e.target.tagName.toLowerCase() === 'html'){
							$.proxy(that.unbind, that)(e);
						}
					})
					.mouseup($.proxy(this.unbind, this));
					
					
					//this.movePart.mouseleave($.proxy(this.unbind, this));
				}			
			},

			bind : function(e){
				this.movePart.bind({
					'mousemove' : $.proxy(this.dragMove, this)						
				});
				this.dragStart(e);
			},
			
			unbind : function(e){
				this.dragStop(e);
				this.movePart.unbind({
					'mousemove' : $.proxy(this.dragMove, this)					
				});				
			},
			
			
			dragStart : function(e){
				e.preventDefault();				
				var view = this.view, off = view.offset();	
				this.startPositoin = {cx:e.clientX, cy:e.clientY, left:off.left,top:off.top, gap: e.clientY - off.top};
				view.addClass(this.dlagIngCls);
				this.beforeDarg && this.beforeDarg();
			},
			
			dragStop : function(e){				
				if(this.moved){
					//console.log('dragStop-----------------');
					this.moved = false;
					var view = this.view, outResult;	
					view.removeClass(this.dlagIngCls);
					if(this.outside === true && (outResult = this.isOutside()) !== false){ //超出边界恢复拖动前位置
						this.recover(outResult);
					}
					this.afterDrag && this.afterDrag(true);
				}else{
					this.afterDrag && this.afterDrag();
				}
			},
			
			dragMove : function(e){
				//console.log('dragMove--');
				this.moved = true;
				e.preventDefault();
				var cache = this.startPositoin, 
					view = this.view,
					_left = e.clientX - cache.cx + cache.left,
					_top = e.clientY-cache.gap;

					if(this.onlyChange !== false){//模拟导行条功能使用
						if(this.onlyChange === 'left'){
							if(this.outsideStop){
								_left = _left > this.maxLeft ? this.maxLeft : _left;
								_left = _left < this.minLeft ? this.minLeft : _left;
							}
							view.offset({left:_left});
						}else{
							if(this.outsideStop){
								_top = _top > this.maxTop ? this.maxTop : _top;
								_top = _top < this.minTop ? this.minTop : _top;
							}
							view.offset({top:_top});
						}
					}else{
						view.offset({left:_left,top:_top});
					}
				this.moveing && this.moveing(_left, _top / (this.maxTop -  this.minTop));
			},			
			
			
			//--------------------------判断是否超出边界--------------------------
			isOutside : function(){
				if(!this.outside)
					return false;
				var view = this.view, offset = view.offset(), tmin, tmax, omin, omax;
				if( (tmin = offset.top < this.minTop) |
					(tmax = offset.top> this.maxTop) |
					(omin = offset.left < this.minLeft) |
					(omax = offset.left> this.maxLeft)){
					return this.outsideToLimit ? [tmin, tmax, omin, omax] : true;
				}
				return false;
			},
			
			recover : function(outResult){
				var view = this.view, startPositoin = this.startPositoin;
				if(!outResult || outResult === true)
					view.offset({top : startPositoin.top, left : startPositoin.left});
				else{
					var offset = view.offset(),
						_top = outResult[0] ? this.minTop : (outResult[1] ? this.maxTop : offset.top),
						_left = outResult[2] ? this.minLeft : (outResult[3] ? this.maxLeft : offset.left);
					view.offset({top : _top, left : _left});
				}	
			}
			
			//--------------------------判断是否超出边界结束--------------------------
		}

		
	
		
		var offtop = 200;
		var offMargin = 400;
		var jqview = $('#dragBar'),
			container = $('#scrollBar');
		function initTipDarg(moving, afterFn, beforeDarg){	
			new Drag({
				view : jqview,
				handle : jqview,
				outsideStop : true,
				onlyChange : 'left',
				container:container,
				beforeDarg : function(){
					beforeDarg && beforeDarg();
				},
				moveing : function(l){
					moving && moving((l- offMargin)/ (container.width()));
				},
				afterDrag : function(move){
					if(move){
						var view = this.view, offset = view.offset(),
							_left = offset.left, _top = offset.top;
							//console.log('left:'+_left);
						afterFn && afterFn((_left- offMargin)/ (container.width()), _top / (this.maxTop -  this.minTop));
					}else{
						afterFn && afterFn();
					}
				}
			});
			
		}

		window['sc'] = new pptScroll({pages : [
		"SU8vU2twdC9xT2hOR0pSeUwwYlhZYkNlVzZzUzM2SXJQYTVtQ1ZxT1k3d2lMODBHb2N0Y0p2WVphWjNsdGpQaThJd2VmNXZLT0RCcGpKOTZDUTN4dlE9PQ==",
		'RjFkS1E1bVowdzFnWGZHblNBeDREUTJUWXVCTTlyVXdGZHJ3U3RSR1NRUEJPS2l1OFIyMk9iU3dnQzdwUm9lKzE0OVBOLys2UGRCNDFlY21TSWw3V2c9PQ',
		'ejhjK25CRWx0TlR0SW8wUSttT0RpMHpZUG5NMDNVSGp4RkdRODNPNGFHRkdpSlZBaGJqQ1lHVW44dVdBQWJMc0REMGtwcG9SdElQRkxKN0cyNWpJQVE9PQ',
		'eU9BS2dYT0NwZDNTaDdRdDBjVUYrZm9Eb2FRZSs1WTcrcjFiZGpBTlRIVXRIaWNNN3AvQ0gwVE40ZnBHQVJ1NGF5SG5ueWw5TFphRytncjkxejhMTGc9PQ'
		], total:20});
		
		*/
	});
</script>
</body>
</html>
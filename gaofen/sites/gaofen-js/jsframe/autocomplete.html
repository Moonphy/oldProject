<!doctype html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<link type="text/css" href="css/base.css" rel="stylesheet">
	<link type="text/css" href="css/bootstrap.min.css" rel="stylesheet">
	<title>自动完成</title>
    <script type="text/javascript" src="gaofen.js"></script>
	<style>
		.form{
			margin-left : 100px;
		}
		.search-box {
			position: relative;
			margin: 9px 25px 0 100px;
			width: 175px;
			height: 29px;
			z-index: 2;
			_display: inline;
		}
		
		.search-box .search-btn {
			float: right;
			margin: 3px 3px 0 0;
			width: 28px;
			height: 23px;
		}
		
		.search-btn {
			background-position: 5px -136px;
			}
			
		.search-box .search-input {
			padding: 4px 0 4px 8px;
			width: 129px;
			height: 20px;
			border: 0;
			line-height: 20px;
			font-size: 12px;
			background: transparent;
			}
		.search-input {
			color: #939393;
		}
		
		.search-result {
			position: absolute;
			top: 29px;
			left: 1px;
			width: 171px;
			padding: 0 0 5px;
			background: #FFF;
			border: 1px solid #797979;
			border-radius: 0 0 3px 3px;
			display: block;
			list-style-type: none;
		}
		ul {
			margin : 0;
		}
	</style>
</head>

<body>	

	<div>
		<br>
		</br>		<br>
		</br>		<br>
		</br>
		
		<div id="searchBox" class="search-box">
				<a href="#" class="search-btn" rel="e:btn">搜索</a>
				<input type="text" value="自动完成" id="sinput" class="search-input">
			    <ul class="search-result hidden">
					<li>1</li>
					<li>2</li>
				</ul>
	</div>
	
	<br><br>
	<div id="sv"> 一般输入框：<input type="text" value="请输入" id="search" class="search-input"><a href="#" class="search-btn" id="sbtn">搜索</a></div>
<script>
	$(document).ready(function(){
		var G = Gaofen,
			Req=G.request,
			searchBox = $('#searchBox');
			
			//一般输入框
			G.use('AutoInput', {
					view : $('#sv')[0],
					inputor : $('#search'),
					defautText : '请输入搜索内容',
					onkeydown : function(e){
						if(e.keyCode == 13){
							this.submit();
						}
					},
					onViewReady : function(){
						G.ui.AutoInput.prototype.onViewReady.call(this);
						var that = this;
						this.jq('#sbtn').click(function(){
							that.submit();
						});
					},
					submit : function(){
						var v = this.getVal();
						if(v !== this.defautText && v !== ''){
							location.href = url + encodeURI(v);
						}
					}
				}).play(1);
			
			
			
			//自动完成
				var ac = G.use('AutoComplete', {
					view : searchBox[0],
					inputor : searchBox.find('#sinput'),
					url : G.request.mkUrl('common','mapKeyword'),
					defautText : '请输入内容',
					onchange : function(e){
						
						var self = this, kw = this.val;
						//console.log(this.pingMail(kw));
						this.loadComplete(new Req.DefaultResponseDefinition({rst:true, data:this.pingMail(kw)}), kw);
						return;
					},//邮件
					pingMail : function(key){
		    				var mail_list=["@qq.com","@163.com","@126.com","@sina.com.cn","@hotmail.com","@sohu.com","@gmail.com"],
		    				arr=[];
		    				$.each(mail_list,function(index,obj){
		    					var indexs=0;
		    					if(key.indexOf('@')!="-1"){
		    						var str_last=key.substring(key.indexOf("@"));
		    						if(str_last=="@"){
		    							arr.push({cname:key.replace("@","")+obj,id:index})
		    						}else{
		    							var ms=obj.match(str_last);
			    						if(ms){
											arr.push({cname:key.replace(str_last,"")+obj,id:indexs})
											indexs++;
										}	
		    						}
		    					}
		    					else{
									arr.push({cname:key+obj,id:index})
								}
							});		    			
						return arr;
					},
					listView :searchBox.find('ul'),
					onEnter : function(row){
						this.inputor.data('dataRow', row).val(row.cname);
						this.showListView(0);
					}
					
					
				});
				ac.play(1);
	
	});
	
</script>
</body>
</html>
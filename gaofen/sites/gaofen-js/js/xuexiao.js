/*!15-12-2014 16:38 Gaofen-js */
"use strict";!function(){function t(t){$.extend(this,{view:"",autoPanel:"",uri:"/admin/entry/ajaxEntries/string/",input:"",delay:500,max:10,choosedMax:1,autoJump:!1,floatCs:".dropdown-menu",choosedCs:"labels",delCs:"del",timer:null,choosed:'<span class="label label-success" rel="id:{.id}">{.text}<i class="glyphicon glyphicon-remove"></i></span>',itemTemp:'<li rel="{.id}"><a tabindex="-1" href="#">{.name}( {.school_type_name})</a></li>',floatTemp:"{.lis}"},t);this.init()}var e={on:function(t,i){e.actions.reg("self_"+t,i)},fire:function(t,i){var n=e.actions.get("self_"+t);n?"array"===$.type(n)?$.each(n,function(t,e){e(i)}):n(i):console||console.log("no event")},util:{parse:function(t,e){var i=/\{(\.?[\w_|$]+)(\.[\w_$]+)?\}/g;return t.replace(i,function(t,i){var n,a,s,r;return 46===i.charCodeAt(0)&&(s=i.substr(1),a=s.split("|"),r=a.shift(),n=void 0===e[r]?"":e[r]),n})},parseKnV:function(t){var e,i={},n=t.split(",");try{for(var a=0,s=n.length;s>a;a++)-1===n[a].indexOf(":")?i[n[a]]=!0:(e=n[a].split(":"),i[e[0]]=e[1])}catch(r){throw"Syntax Error:rel字符串格式出错。"+t}return i},bind:function(t,e){return function(){return t.apply(e,arguments)}},isEmail:function(t){return/.+@.+\.[a-zA-Z]{2,4}$/.test(t)},byteLen:function(t){var e=t.length,i=t.match(/[^\x00-\xff]/g);return i&&(e+=i.length),e},tinymce:function(t){var e={mode:"exact",theme:"modern",statusbar:!1,height:250,elements:"editor",language:"zh_CN",setup:function(){},plugins:["filemanager","image","code","link"],toolbar:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image code"};t&&$.extend(e,t),tinymce.init(e)},drawImage:function(t,i,n,a){function s(s){if(s&&(r=s),r.width>0&&r.height>0){var c=e.util.getRealSize(r.width,r.height,i,n);o&&(t.width=c[0],t.height=c[1]),a&&a({width:c[0],height:c[1]})}}var r=new Image,o="object"==typeof t;o&&t.complete?s(t):($(r).load(function(){s()}),r.src=t)},getRealSize:function(t,e,i,n){var a,s;return t/e>=i/n?t>i?(a=i,s=e*i/t):(a=t,s=e):e>n?(s=n,a=t*n/e):(a=t,s=e),[a,s]}},tips:{alert:function(t,e){toastr[e||"success"](t)}},event:function(){$("body").on("click",function(t){for(var i=$(t.target),n=(i.attr("rel"),[]),a=0;10>a;a++){var s=i.attr("rel");if(s){var r=e.util.parseKnV(s);n.push(r)}i=i.parent()}var o=n.length;if(o)for(var c=0;o>c;c++){var l=e.actions.get(n[c].e);l&&(t.preventDefault(),l(t,n[c]))}})},actions:{evts:{},get:function(t){return this.evts[t]},reg:function(t,e){if(this.evts[t]){var i=this.evts[t];if("array"===$.type(i))i.push(e);else{var n=[i];n.push(e),this.evts[t]=n}}else this.evts[t]=e;return this}},getRouter:function(t,i){if("admin"===e.place){return"/Czadmin"+t}return t},cls:{},getCmpUrl:function(t){return this.getRouter(location.href.indexOf("dev")>0?"/cz/school/cmp?ids="+t.join(","):"/chuzhong/duibi_"+t.join("_")+".html")}};e.cls.Ajax={send:function(t,e,i,n){switch(e?e.__rnd=+new Date:e={__rnd:+new Date},n=n||"get"){case"get":$.get(t,e,i);break;case"post":$.post(t,e,i);break;case"jsonp":$.getJSON(t,e,i)}}},t.prototype={couser:null,cache:{},currData:"",init:function(){this.autoPanel||(this.autoPanel=this.view);var t=this;this.input=this.input||this.view,$(this.input).on("keyup click",function(e){clearTimeout(t.timer),t.timer=setTimeout(function(){t.get.call(t,e)},t.delay)}),$("body").on("click",function(e){t.afterClickBody(e)}),this.view.on("click",this.floatCs+" li",function(e){t.autoJump?t.hide():(e.preventDefault(),t.afterChoosed($(this))),t.removeFloat()}),this.view.on("click","."+this.choosedCs+" ."+this.delCs,function(){$(this).parent().remove()}),this.view.cmpObj=this,this.initReady()},initReady:$.noop,afterClickBody:function(t){0===$(t.target).closest(this.autoPanel).length&&$(t.target).is(this.input)===!1&&this.hide()},afterChoosed:function(t){{var e=this.currData;t.attr("rel")}this.createChoosed(e.list[t.index()]),this.clearInput("")},clearInput:function(t){this.setVal(t)},removeFloat:function(){this.view.find(this.floatCs).html("")},getVal:function(){return $.trim("text"===this.input.attr("type")||"textarea"===this.input.attr("type")?this.input.val():this.input.text())},setVal:function(t){"text"===this.input.attr("type")||"textarea"===this.input.attr("type")?this.input.val(t):this.input.text(t)},get:function(){var t=this.getVal();this.input.focus(),t?this.getByAjax(t):this.reset()},getByAjax:function(t){var i=this.cache[t],n=this;i?this.reader(i):e.cls.Ajax.send(this.uri+t+"&__rnd="+ +new Date,"",function(e){"object"!==$.type(e)&&(e=JSON.parse(e)),"0"==e.errno&&(i=n.cache[t]=e.rst,n.reader(i))})},getSchool_type_name:function(t){return"1"==t?"高中":"2"==t?"初中":"小学"},reader:function(t){this.currData=t;var i=[],n=this,a=t.hasOwnProperty("list")?t.list:t;$.each(a,function(t,a){return 10>t?(a.school_type_name=n.getSchool_type_name(a.school_type),void i.push(e.util.parse(n.itemTemp,a))):!1});var s=e.util.parse(n.floatTemp,{lis:i.join("")});this.removeFloat(),i.length>0&&this.view.find(this.floatCs).append(s),this.callBackAfter(t)},callBackAfter:function(){},createChoosed:function(t){var i=this.view.find("."+this.choosedCs);i.find('span[rel="id:'+t.id+'"]').length||(1===this.choosedMax?i.html(e.util.parse(this.choosed,{id:t.id,text:t.name})).show():i.children().length<this.choosedMax&&i.append(e.util.parse(this.choosed,{id:t.id,text:t.name})).show())},reset:function(){this.clearInput(""),this.removeFloat()},hide:function(){this.reset(),this.autoPanel.addClass("hidden")}},e.cls.AutoInput=t,e.PD=function(){"undefined"==typeof e.cfg&&(e.cfg={});var t=e.cfg,i={};return{set:function(e,n){var a=arguments.length;3==a?(i[e]=n,t[e]=n):2==a?$.extend(t,n):1==a&&$.extend(t,e)},get:function(n){var a=arguments.length;return 1==a?t[n]:0===a?e.cfg:i[n]}}}(),window.Gaofen=e}(jQuery,window);
"use strict";!function(t,e,i){function n(e,i){var n=!1;return t.each(i,function(t,i){return i.id===e?(n=!0,!1):void 0}),n}function a(e,i,n){switch(e){case 1:t(i).removeClass("hidden").find("a").replaceWith("<span>已加入对比</span>");break;case 11:i.each(function(e,i){t(i).addClass("hidden").find("span").replaceWith('<a href="#" rel="e:contrast,id:'+n.id+",n:"+n.name+",uri:"+n.uri+'">加入对比</a>')});break;case 2:t(i).find("a").replaceWith("<span>已加入对比</span>");break;case 21:i.each(function(e,i){t(i).find("span").replaceWith('<a href="#" rel="e:contrast,id:'+n.id+",n:"+n.name+",uri:"+n.uri+'">加入对比</a>')});break;case 3:i.addClass("btn-added-comparison").find("span").text("取消对比");var a=i.attr("rel");i.attr("rel",a.replace("e:contrast","e:cancelcmp"));break;case 31:i.removeClass("btn-added-comparison").find("span").text("加入对比");var a=i.attr("rel");i.attr("rel",a.replace("e:cancelcmp","e:contrast"))}}function s(){var e=[];t("#cmpdata tr.tb-header td[rel]").each(function(i,n){t(n).attr("rel")&&e.push(t(n).attr("rel"))}),location.href=i.getCmpUrl(e)}function o(e){var i=m.get();t("#pk").find("span")[i.length?"removeClass":"addClass"]("hidden").text(i.length),i.length&&!e&&(t("#pk").addClass("ani"),setTimeout(function(){t("#pk").removeClass("ani")},500))}function r(e){var i=t.extend({cs:"",title:"",bodyHtml:"",appendTo:"body"},e),n=d.parse(y.modal,i);return t(n).appendTo(i.appendTo)}function l(e){var i=r(t.extend({title:"提示",tip_cs:"alert-info",bodyHtml:d.parse(y.tips,e)},e));return i.on("click","a.close,a.btn-primary",function(t){t.preventDefault(),i.remove()}).on("click",function(t){t.stopPropagation()}).removeClass("hidden"),t("body").on("click",function(){i.remove()}),i}function c(){if(!w){var e=r({cs:"modal-comparison",title:"对比学校",bodyHtml:y.pk});return t("body").on("click",function(){w.hide()}),e.on("click",function(t){t.stopPropagation()}).on("click","a.close,a.btn-primary",function(e){e.preventDefault(),"cmp"!==t(this).attr("rel")?w.hide():m.cmp()}).on("click","a.btn-small",function(e){e.preventDefault();var n=t(e.target).closest("li"),a=n.attr("rel");m.del(a)&&(n.remove(),i.fire("showPkBox",{num:m.get().length}))}).on("click","#clearAll,#toDel",function(e){e.preventDefault(),"clearAll"===t(this).attr("id")?(m.clear(),w.hide()):i.fire("showPkBox",{num:f})}),w={beforeShow:function(){var e=m.get(),i=[];t.each(e,function(t,e){i.push(d.parse(y.pkli,e))}),this.getView().find("ul").html(i.join(""))},getView:function(){return e},show:function(){this.beforeShow(),e.removeClass("hidden")},hide:function(){e.addClass("hidden")}}}}var d=i.util,h=(i.tips.alert,i.PD),u="schoolList",f=4,v=navigator.userAgent.indexOf("MSIE 6.0")>0;i.place="front";var p,m={get:function(e){var i=d.localStorage.get(u);return i=i?t.parseJSON(i):[],void 0===e?i:"number"===t.type(e)||1===e.split(",")?this.match(e,i):void 0},clear:function(){var e=this.get(),i=this;t.each(e,function(t,e){i.del(e.id)})},match:function(e,i){i=i||this.get();var n;return t.each(i,function(t,i){return i.id==e?(n=i,!1):void 0}),n},isHas:function(t,e){return this.match(t,e)},add:function(t,e){var n=this.get();return this.isHas(t.id,n)?(alert("学校已添加"),!1):(n.push(t),d.localStorage.set(u,JSON.stringify(n)),i.fire("joincmp",{dom:e,data:t}),!0)},del:function(e){var n,a=this.get(),s=!1;return t.each(a,function(t,i){return i.id==e?(n=i,a.splice(t,1),s=!0,!1):void 0}),s&&(d.localStorage.set(u,JSON.stringify(a)),i.fire("deletecmp",{item:n})),s},cmp:function(){var e=m.get();if(e.length>1){var n=[];t.each(e,function(t,e){n.push(e.id)}),location.href=i.getCmpUrl(n)}}},g=function(e){function n(){if(c&&c.length){var t=c.offset();o={x:t.left+40,y:t.top}}}function a(t){t=t||window.event;var e={x:0,y:0};return t.pageX||t.pageY?(e.x=t.pageX,e.y=t.pageY):(e.x=t.clientX+document.body.scrollLeft-document.body.clientLeft,e.y=t.clientY+document.documentElement.scrollTop),e}function s(){var t=r.css("top").split("p")[0],e=r.css("left").split("p")[0];return t>=o.y&&e>=o.x?(l=60,r.remove(),void i.fire("moveSuccess",{target:c,org:r})):(r.css({top:t-0+(o.y-t-10*(l-1))/(l-0)+"px"}),e<o.x&&r.css({left:e-0+(o.x-e)/(l-0)+"px"}),l--,void setTimeout(s,12))}var o,r,l=45,c=e;return n(),{move:function(t){var e=a(t);n(),r.css({top:e.y+"px",left:e.x+"px"}),s()},createOrg:function(e){var i=t('<div class="pk-dot"></div>'),n=e.offset();r=t(i).css({top:n.top,left:n.left}).appendTo("body")}}},b=function(e){e.length&&new i.cls.AutoInput({view:e,floatCs:"ul",autoPanel:e.find("div.dropdown"),autoJump:!0,itemTemp:'<li  rel="{.id}"><a target="_blank" tabindex="-1" href="{.link}">{.name}</a></li>',uri:i.getRouter("/ajax/search?q="),afterClickBody:function(e){0===t(e.target).closest(this.autoPanel).length&&t(e.target).is(this.input)===!1&&"button"!==e.target.tagName.toLowerCase()&&this.hide()},callBackAfter:function(t){this.autoPanel.removeClass("hidden"),t.length?(this.view.find("ul").parent().removeClass("hidden"),this.view.find(".tips-null").parent().addClass("hidden")):(this.view.find("ul").parent().addClass("hidden"),this.view.find(".tips-null").parent().removeClass("hidden")),this.bdrag.view[this.bdrag.reset()?"addClass":"removeClass"]("scrollable")},input:e.find("input"),initReady:function(){var t=this.view.find("div.query-result").eq(1),e=t.find("div.scroll-thumb"),n=t.find("div.scroll-bar");this.bdrag=new i.cls.DragBase({view:t,dragBar:e,scrollBar:n})}})};i.event(),t(function(){i.on("setpk",function(t){o(t)}),i.on("moveSuccess",function(){i.fire("setpk")}),i.on("deletecmp",function(){i.fire("setpk")}),i.on("showPkBox",function(t){var e=E.getView(),i=e.find("#mb").children(":lt(3)");i.addClass("hidden"),i.eq(t.num>f?2:0===t.num?0:1).removeClass("hidden"),E.show()}),t("#pk").on("click",function(t){t.preventDefault(),t.stopPropagation(),i.fire("showPkBox",{num:m.get().length})});var e=h.get("channel"),s=h.get("action"),r=h.get("hasPKfloat");switch(e){case"xuexiao":switch(s){case"index":var u=!1,w=1;t("#more_btn").on("click",function(e){if(e.preventDefault(),u!==!0){u=!0;var n,a=location.search;n=a&&/page=/.test(a)?a.replace(/page=\d/,"page="+ ++w):a?a+"&page="+ ++w:"?page="+ ++w;var s="view-loading",o=t(this).parent().addClass(s);i.cls.Ajax.send(i.getRouter("/cz/school/ajaxSchools"+n),"",function(e){"0"==e.errno&&(t("#school_list").append(e.rst.html),t("#school_list").children().length>=Number(e.rst.total)&&t("#more_btn").parent().hide(),o.removeClass(s)),u=!1},"post")}}),i.on("joincmp",function(e){t('li[rel="'+e.data.id+'"]').each(function(e,i){a(2,t(i).find("div.operations"))})}),i.on("deletecmp",function(e){t('li[rel="'+e.item.id+'"]').each(function(i,n){a(21,t(n).find("div.operations"),e.item)})});var C=m.get(),x=t("li>div.operations");C.length&&x.each(function(){n(t(this).closest("li").attr("rel"),C)&&a(2,this)}),b(t("#bodySearch"));break;case"detail":i.on("joincmp",function(){a(3,t("#contrastBtn"))}),i.on("deletecmp",function(){a(31,t("#contrastBtn"))});var k=d.parseKnV(t("#contrastBtn").attr("rel")).id;m.match(k)&&a(3,t("#contrastBtn"));var S=t('<div class="tabs-fixed hidden"><div class="container"></div></div>').appendTo("body");S.find(".container").html(t("div.tabs").clone()),t(window).scroll(function(){var e=t(this).scrollTop();e>422?S.removeClass("hidden"):S.addClass("hidden")}),t(window).scroll(),t("div.school-list ul li").hover(function(){t(this).find("span.operations").removeClass("hidden")},function(){t(this).find("span.operations").addClass("hidden")});break;case"picture":var B=function(e){t.extend(this,{auto:!1,view:null,viewMain:null,viewThumb:null,showThumb:5,firstCs:"show-prev",lastCs:"show-next",count:10,imgList:null,index:1,controlView:null},e),this.init()};B.prototype={init:function(){this.setPage();var e=this;this.count=this.imgList.length,this.viewThumb=this.view.find(".thumbnails"),this.viewMain.hover(function(){e.setMainCs(!0)},function(){e.setMainCs()}),this.viewMain.on("click","a",function(i){i.preventDefault();var n="prev";t(this).hasClass("next")&&(n="next"),e.setIndex(n),e.setPage(),e.setMainCs(!0),e.view.trigger("changeImg",{toPage:n})}),this.viewThumb.length&&(this.view.on("changeImg",function(t,i){e.setThumbPage(),e.setLittlePic(i),e.setTitle()}),this.viewThumb.on("click","a.next,a.prev,li",function(i){if(i.preventDefault(),"a"===this.tagName.toLowerCase()){var n="prev";if(t(this).hasClass("next")&&(n="next"),"prev"===n&&1===e.index)return;if("next"===n&&e.index===e.count)return;e.setIndex(n),e.view.trigger("changeImg",{toPage:n}),e.setPage(),e.setMainCs()}else t(this).hasClass("active")||(e.index=t(this).index()+1,e.view.trigger("changeImg",{toPage:n}),e.setPage(),e.setMainCs())}))},setMainCs:function(t){t?(1===this.index?this.viewMain.removeClass(this.firstCs):this.viewMain.addClass(this.firstCs),this.index===this.count?this.viewMain.removeClass(this.lastCs):this.viewMain.addClass(this.lastCs)):this.viewMain.removeClass(this.lastCs).removeClass(this.firstCs)},getBigPic:function(){return this.imgList[this.index-1]},setIndex:function(t){this.index="next"===t?++this.index:--this.index},setPage:function(){var t=this.getBigPic(),e=this;this.viewMain.find("img").attr("src",""),this.view.find("div.pages").html("<span>"+this.index+"</span>/"+this.count),d.drawImage(t,600,450,function(i){e.viewMain.find("img").attr("src",t).css({width:i.width,height:i.height})})},setThumbPage:function(){this.viewThumb.find(".active").removeClass(),this.viewThumb.find("li").eq(this.index-1).addClass("active")},setLittlePic:function(t){var e=t.toPage,i=this.viewThumb.find("ul"),n=parseInt(i.css("marginLeft")),a=Math.abs(n/-130),s=null;if("next"===e){var o=a+5;this.index>o&&(s=n-130)}else this.index<a+1&&(s=n+130);null!==s&&i.css("marginLeft",s+"px")},setTitle:function(){var t=this.viewThumb.find("li.active span").text();this.view.find("div.title").text(t)}};var D=h.get("imgList");D.length>1&&new B({imgList:D,view:t("#pic_body"),viewMain:t("#picView")});break;case"guide":var P=function(t,e){e.eq(0)[t?"addClass":"removeClass"]("hidden"),e.eq(1)[t?"removeClass":"addClass"]("hidden")},T=h.get("type");if("2"==T){var u,H=t("#actions").children(),I=[];t(".form-row input[type=checkbox]").on("click",function(e){var i=t(".form-row input[type=checkbox]:checked");i.length?(P(!1,H),I=[],i.each(function(t,e){I.push(e.value)}),I.length>2&&(e.preventDefault(),setTimeout(function(){l({tip_cs:"alert-error",msg:"亲，别太贪心呐！最多选2项。"})},1))):(I=[],P(!0,H))}),H.eq(0).on("click",function(e){e.preventDefault(),!u&&I.length&&(u=!0,t("#guide_type2").attr("action",location.href.replace("step=1","step=2")).submit())})}else if("1"==T){var q=t("#guide_type1"),M=q.find("select"),L=q.find("div.actions").children(),j=h.get("admitForte"),O=function(e,i){var n=[];for(var a in e){var s="string"===t.type(e[a])?e[a]:e[a].name;n.push('<option value="'+a+'">'+s+"</option>")}i.html(n.join(""))};M.eq(1).change(function(){var t=this.value;O(j[t].child,M.eq(2))}),O(j,M.eq(1)),M.eq(1).trigger("change");var u=!1;M.eq(0).change(function(){u=!!this.value,P(!u,L)}),P(!0,L),L.eq(0).on("click",function(e){e.preventDefault(),t("#guide_type1").attr("action",location.href.replace("step=1","step=2")).submit()})}break;case"cmp":var A=t(d.parse(y.cmpHeader,{headHtml:t(".comparison-table tr.tb-header").html()})).appendTo("body");A.hide().removeClass("hidden"),t.each(A.find("td[rel]"),function(e,i){var n=t(i);n.find(n.attr("rel")?".switcher":".name-wrap").remove()}),t(window).scroll(function(){var e=t(this).scrollTop();A[e>=173?"show":"hide"](),v&&A.css({top:th})}),v&&A.css({position:"absolute",bottom:"0"});break;case"rank":i.on("joincmp",function(e){t('li[rel="'+e.data.id+'"]').each(function(e,i){a(1,t(i).find("span.operations"))})}),i.on("deletecmp",function(e){t('li[rel="'+e.item.id+'"]').each(function(i,n){a(11,t(n).find("span.operations"),e.item)})});var _=function(e){return t(e).find("span.operations:has(a)").length},N=function(e,i){var s=m.get();e=e||t("li>span.operations"),s.length&&e.each(function(){n(t(this).closest("li").attr("rel"),s)&&a(1,this)}),i=i||t("li:has(span.operations)"),i.each(function(e,i){t(i).hover(function(){_(i)&&t(this).find("span.operations").removeClass("hidden")},function(){_(i)&&t(this).find("span.operations").addClass("hidden")})})};N();var R={},J=function(e){t("#tagLists ul").remove(),t("#tagLists").html(e),N(t("#tagLists span.operations"),t("#tagLists li:has(span.operations)"))};t("#tags").on("click","a",function(e){e.preventDefault();var n=t(this),a=n.attr("rel");if(!n.hasClass("active"))return t("#tags a.active").removeClass("active"),n.addClass("active"),R[a]?void J(R[a]):void i.cls.Ajax.send(i.getRouter("/cz/school/rankPartOfDistrict"),{did:a},function(t){"0"==t.errno&&(J(t.rst),R[a]=t.rst)})})}}if(r!==!1&&"false"!==r){var E=c();t("#pk").removeClass("hidden"),i.fire("setpk",{noani:!0}),p=g(t("#pk"))}b(t("#searchArea")),function(){function e(){var e=t(window).scrollTop(),n=document.documentElement.clientHeight-81;i.css({top:e+n})}var i=t("#goTop").hide();0!==i.length&&(t.browser.msie&&"6.0"==t.browser.version&&(i.css({position:"absolute",bottom:"0"}),setInterval(e,1)),i.click(function(e){e.preventDefault(),t("body,html").animate({scrollTop:0},800)}),t(this).scrollTop()>0&&i.fadeIn(500),t(window).scroll(function(){var e=t(this).scrollTop();e>200?i.fadeIn(500):i.fadeOut(500)}),t(window).scroll())}()}),i.actions.reg("attention",function(){}).reg("contrast",function(e,n){var a,s=m.get();if(s.length){if(s.length>=f)return void setTimeout(function(){i.fire("showPkBox",{num:f+1})},10);a=m.add({name:n.n,id:n.id,uri:n.uri},e.target)}else a=m.add({name:n.n,id:n.id,uri:n.uri},e.target);a&&(v?i.fire("setpk"):(p.createOrg(t(e.target)),p.move(e)))}).reg("addcmp",function(e){var n=t(e.target),a=t("body").data("addcmpBox");if(a)0===n.parent().find("div.dropdown").length?(a.cmpObj.reset(),a.appendTo(n.parent()).show()):a.show(),a.cmpObj.input.focus();else{a=t(d.parse(y.addcmp,{})).appendTo(n.parent()),t("body").data("addcmpBox",a);{new i.cls.AutoInput({view:a,floatCs:"ul",max:25,itemTemp:'<li rel="{.id}"><a target="_blank" tabindex="-1" href="{.link}">{.name}</a></li>',uri:i.getRouter("/ajax/search?q="),reset:function(){this.clearInput(""),this.view.find(".query-result").eq(0).addClass("hidden"),this.view.find(".query-result").eq(1).removeClass("hidden").removeClass("scrollable"),this.removeFloat()},initReady:function(){var e=this;this.view.find("span.close").on("click",function(){e.reset()}),this.input.on("focus",function(){t(this).parent().addClass("query-focus")}).on("keyup",function(){t(this).parent()[t.trim(this.value)?"addClass":"removeClass"]("query-inserting")}).blur(function(){t(this).parent().attr("class","query")}).focus();var n=this.view.find("div.query-result").eq(1),a=n.find("div.scroll-thumb"),s=n.find("div.scroll-bar");this.bdrag=new i.cls.DragBase({view:n,dragBar:a,scrollBar:s})},afterClickBody:function(e){t(e.target).hasClass("trigger")||a.hide()},callBackAfter:function(t){t.length?(this.view.find("ul").parent().removeClass("hidden"),this.view.find(".tips-null").parent().addClass("hidden")):(this.view.find("ul").parent().addClass("hidden"),this.view.find(".tips-null").parent().removeClass("hidden")),this.bdrag.view[this.bdrag.reset()?"addClass":"removeClass"]("scrollable")},afterChoosed:function(e){var i=a.closest("td"),n=e.attr("rel");if(this.hide(),i.attr("rel")!==n){var o=i.index();t("#cmpdata tr.tb-header td").eq(o).attr("rel",n),s()}},input:a.find("input")})}a.on("click",function(t){t.stopPropagation()})}}).reg("cmpDel",function(e){var i=t(e.target).closest("td").attr("rel");t('#cmpdata td[rel="'+i+'"]').attr("rel",""),s()}).reg("cmp",function(){var e=m.get();if(e.length){var n=[];t.each(e,function(t,e){n.push(e.id)}),location.href=i.getCmpUrl(n)}}).reg("cancelcmp",function(t,e){e.id&&m.del(e.id)}),d.localStorage=function(t){return"localStorage"in e||(e.localStorage=function(){var t,i=!!document.all;return i&&(t=document.createElement("div"),t.style.display="none",document.body.appendChild(t),t.addBehavior("#default#userdata")),{setItem:function(n,a,s){i?(t.setAttribute(n,a),t.save(s?s:n)):e.globalStorage[location.hostname][n]=a},getItem:function(n,a){if(i)try{return t.load(a?a:n),t.getAttribute(n)}catch(s){return""}return e.globalStorage[location.hostname][n]||""},removeItem:function(n,a){i?(t.removeAttribute(n),t.save(a?a:n)):e.globalStorage[location.hostname].removeItem(n)}}}()),{page:t,get:function(t,e){return localStorage.getItem(t,e)},set:function(t,e,i){return localStorage.setItem(t,e,i)},remove:function(t,e){return localStorage.removeItem(t,e)},initEx:function(){}}}(),"undefined"==typeof JSON&&(JSON={}),JSON.stringify=JSON.stringify||function(t){var e=typeof t;if("object"!=e||null===t)return"string"==e&&(t='"'+t+'"'),String(t);var i,n,a=[],s=t&&t.constructor==Array;for(i in t)n=t[i],e=typeof n,"string"==e?n='"'+n+'"':"object"==e&&null!==n&&(n=JSON.stringify(n)),a.push((s?"":'"'+i+'":')+String(n));return(s?"[":"{")+String(a)+(s?"]":"}")};var w,y={addcmp:['<div class="dropdown">','<div class="query">','<input type="text"  autocomplete="off" placeholder="请输入您要查找的学校名">','<span class="close"></span>',"</div>",'<div class="query-result hidden">','<div class="tips-null">暂未能找到，换所学校试试？</div>',"</div>",'<div class="query-result">',"<ul></ul>",'<div class="scroll-bar">','<div class="scroll-track"></div>','<div style="height:40px;" class="scroll-thumb"></div>',"</div>",'</div><i class="arrow"><i class="arrow-border"></i><i class="arrow-body"></i></i>',"</div>"].join(""),modal:['<div class="modal modal-tips hidden {.cs}"><div class="modal-header"><h3>{.title}</h3></div><div class="modal-body" id="mb">{.bodyHtml}</div><a data-dismiss="modal" href="#" class="close">×</a></div>'].join(),pk:['<div id="noResult">','<div class="alert alert-info">','<i class="ico"></i>','<div class="info"><p>您未选择对比学校，暂时无法对比</p></div></div>','<div class="actions"><a href="#" class="btn btn-primary">确定</a></div>',"</div>",'<div id="schoolList" class="comparison-list"><ul></ul>','<div class="actions"><a href="#" class="btn btn-primary" rel="cmp">开始对比</a></div>',"</div>",'<div id="outLists">','<div class="alert alert-info"><i class="ico"></i><div class="info"><p>对不起！每次最多可对比4所学校。您可以：</p><p><a href="#" id="clearAll">清空对比筐</a> 或者 <a href="#" id="toDel">取消部分学校</a></p></div></div>','<div class="actions"><a href="#" class="btn btn-primary">确定</a></div>',"</div>"].join(""),pkli:'<li rel="{.id}"><div class="operations"><a href="#" class="btn btn-small">取消对比</a></div><div class="name"><a href="{.uri}" target="_blank">{.name}</a></div></li>',cmpHeader:['<div class="comparison-fixed hidden" id="cmpHeader"><div class="inner"><div class="container"><div class="comparison-table"><table><tbody><tr class="tb-header">{.headHtml}</tr></tbody></table></div></div></div></div>'].join(""),tips:['<div class="alert {.tip_cs}"><i class="ico"></i><div class="info"><p>{.msg}</p></div></div><div class="actions"><a href="#" class="btn btn-primary">确定</a></div>'].join("")},C=function(e){t.extend(this,{view:"",handle:"",moved:!1,movePart:t("body"),dragBar:""},e);this.movePart=t("body");this.view,this.handle=this.dragBar;this.init()};C.prototype={init:function(){this.view.length&&this.handle.length&&this.initBind()},reset:function(){var t=this.view.height(),e=this.timeline.height();this.solHeight=t,this.timelineHeight=e;var i=t/e*100;return t>e?!1:(this.timelineoff=t,this.barHeight=i*t/100,this.dragBar.height(i+"%"),this.dragBarHeight=this.dragBar.height(),!0)},initBind:function(){var e=this;this.handle.on("mousedown",function(i){i.preventDefault(),t.proxy(e.bind,e)(i)}).on("click",function(t){t.preventDefault()}),t("body").on("mouseup",function(i){t.proxy(e.unbind,e)(i)}),t(window).mouseup(function(i){i.preventDefault(),t.proxy(e.unbind,e)(i)}).mouseleave(function(i){"html"===i.target.tagName.toLowerCase()&&t.proxy(e.unbind,e)(i)}),this.timeline=this.view.find("ul");var i,n=this.timeline.find("div.active");if(n.length&&(i=n.index())>0){var a,s=0,o=this.timeline.outerHeight();this.timeline.children(":lt("+i+")").each(function(e,i){s+=t(i).outerHeight()}),a=o<=s+this.solHeight?this.solHeight-this.barHeight:s/o*this.solHeight,this.setSrcoll(a)}this.view.on("mouseenter",function(){e.mouseInter=!0}).on("mouseleave",function(){e.mouseInter=!1}),document.addEventListener&&t.browser.mozilla&&document.addEventListener("DOMMouseScroll",t.proxy(this.mouseScrollRun,this),!1),window.onmousewheel=document.onmousewheel=t.proxy(this.mouseScrollRun,this)},mouseInter:!1,mouseScrollRun:function(t){if(t=t||window.event,this.mouseInter){var e="top";t.wheelDelta?e=t.wheelDelta>0?"top":"down":t.detail&&(e=t.detail<0?"top":"down"),this.mathMouseScroll(e,t)}},mathMouseScroll:function(t,e){var i,n,a,s=parseInt(this.dragBar.css("top"));"top"===t&&s>=0?(0===s&&(n=!0),i=s-5,i=i>0?i:0):"down"===t&&s<=(a=this.solHeight-this.dragBarHeight)&&(s===a&&(n=!0),i=s+5,i>a&&(i=a)),n||(e.preventDefault?e.preventDefault():e.returnValue=!1),this.setSrcoll(i)},beforeDrag:t.noop,moveing:t.noop,afterDrag:t.noop,bind:function(e){this.movePart.bind({mousemove:t.proxy(this.dragMove,this)}),this.dragStart(e)},unbind:function(e){this.dragStop(e),this.movePart.unbind({mousemove:t.proxy(this.dragMove,this)})},dragStart:function(t){t.preventDefault();var e=(this.view,parseInt(this.handle.css("top")));this.startPositoin={cx:t.clientX,cy:t.clientY,top:e},this.beforeDrag&&this.beforeDrag(t)},dragStop:function(){if(this.moved){this.moved=!1;{this.view}}else this.afterDrag&&this.afterDrag()},dragMove:function(t){this.moved=!0,t.preventDefault();var e=this.startPositoin,i=(this.view,e.top),n=t.clientY-this.startPositoin.cy+i;this.setSrcoll(n)},setSrcoll:function(t){0>=t?t=0:t>this.solHeight-this.dragBarHeight&&(t=this.solHeight-this.dragBarHeight);this.handle.css("top",t);0!==t&&(t/=this.solHeight-this.dragBarHeight),this.timeline.css({top:-t*(this.timelineHeight-this.solHeight)})}},i.cls.DragBase=C}(jQuery,window,Gaofen);
<?php TPL::output('admin/global/header.tpl.htm'); ?>
<?php TPL::output('admin/global/nav_menu.tpl.htm'); ?>

<div class="aw-content-wrap">
	<div class="mod">
		<div class="mod-head">
			<h3>
				<ul class="nav nav-tabs">
					<li class="active"><a href="#list" data-toggle="tab"><?php _e('专辑管理'); ?></a></li>
				</ul>
			</h3>
		</div>
		<div class="mod-body tab-content">
			<div class="tab-pane active" id="list">

				<input type="hidden" id="action" name="action" value="" />
				<div class="table-responsive">
					<table class="table table-striped">
						<thead>
							<tr class="col-sm-2 col-xs-12">
								<a href="admin/specialist/special_add/" class="btn-primary btn"><?php _e('新建专辑'); ?></a>
							</tr>
							<tr>
								<th><?php _e('排序'); ?></th>
								<th><?php _e('标题'); ?></th>
								<th><?php _e('方法数量'); ?></th>
								<th><?php _e('是否显示'); ?></th>
								<th><?php _e('时间'); ?></th>
								<th><?php _e('操作'); ?></th>
							</tr>
						</thead>
					<?php if ($this->special_list) { ?>
						<tbody>
							<?php foreach ($this->special_list AS $key => $val) { ?>
							<tr>
								<td class="sort" id="<?php echo $val['id'] ?>"><?php echo $val['sort']; ?></td>
								<td><?php echo $val['special_name']; ?></a></td>
								<td><?php echo $val['topic_num']; ?></a></td>
							<?php if($val['is_show'] != -1):?>
								<td><?php echo '显示'; ?></a></td>
							<?php else:?>
								<td><?php echo '隐藏'; ?></a></td>
							<?php endif;?>
								<td><?php echo date_friendly($val['update_time']); ?></td>
								<td>
									<a href="admin/specialist/special_edit/?id=<?php echo $val['id']; ?>" class="icon icon-edit md-tip" title="<?php _e('编辑'); ?>"></a>
									<?php if($val['is_show'] != -1 ): ?>
										<a href="javascript:;" onclick="AWS.ajax_request(G_BASE_URL + '/admin/ajax/special_show/', 'special_id=<?php echo $val['id']; ?>&is_show=-1');" class="icon icon-delete md-tip" title="<?php _e('隐藏'); ?>"></a>
									<?php else: ?>
										<a href="javascript:;" onclick="AWS.ajax_request(G_BASE_URL + '/admin/ajax/special_show/', 'special_id=<?php echo $val['id']; ?>&is_show=1');" class="icon icon-check md-tip" title="<?php _e('显示'); ?>"></a>
									<?php endif; ?>
								</td>
							</tr>
							<?php } ?>
					<?php } ?>
						</tbody>
					</table>
				
				</div>
				<div class="mod-table-foot">
					<?php echo $this->pagination; ?>
				</div>
			</div>
		</div>
	</div>
</div>
<style>
	.float-input{
		position: absolute;
	}
</style>
<script>
	$('.sort').click(function(){
		var dom = $(this), id = dom.attr('id'), num = dom.text(), index = dom.closest('tr').index();
		var offset = $(this).offset(), top = offset.top + 8;
		var input = $('<input rel="'+index+'" vrel="'+num+'" _rel="'+id+'"  onblur="getId(this)" class="float-input" style="top:'+top+'px;left:'+offset.left+'px" />').appendTo('body');
		input.focus();
		var content = $(this).text();
	});
	var getId = function(dom, index, num){
		var jdom = $(dom), v = $.trim(dom.value), num = jdom.attr('vrel'), td = $('table.table-striped>tbody').find("tr").eq(jdom.attr('rel')).find('td').eq(0);
		if(v === ''){
			td.html(num);
		}else{
			var id = jdom.attr('_rel');
			td.html(v);


			AWS.ajax_request(G_BASE_URL + '/admin/ajax/special_sort/', 'special_id='+id+'&sort='+v);
		}

		jdom.remove();
	}
	// .$.post('/path/to/file', {param1: 'value1'}, function(data, textStatus, xhr) {
	// 	/*optional stuff to do after success */
	// });
</script>
<?php TPL::output('admin/global/footer.tpl.htm'); ?>